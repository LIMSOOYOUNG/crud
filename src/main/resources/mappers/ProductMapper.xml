<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.deft.crud.product.model.dao.ProductMapper">
	<resultMap type="com.deft.crud.product.model.dto.ProductDTO" id="productResultMap">
		<id property="productNo" column="PRODUCT_NO"/>
		<result property="sellStatus" column="SELL_STATUS"/>
		<result property="productName" column="PRODUCT_NAME"/>
		<result property="purchasePrice" column="PURCHASE_PRICE"/>
		<result property="sellingPrice" column="SELLING_PRICE"/>
		<result property="unit" column="UNIT"/>
		<result property="categoryCode" column="CATEGORY_CODE"/>
		<result property="accountNo" column="ACCOUNT_NO"/>
		<result property="manufacturerNo" column="MANUFACTURER_NO"/>

		<association property="category" resultMap="productCategoryResultMap"/>		
		
		<association property="manufacturer" resultMap="manufacturerResultMap"/>

		<association property="account" resultMap="accountResultMap"/>
		
	</resultMap>
	
	<resultMap type="com.deft.crud.product.model.dto.ProductCategoryDTO" id="productCategoryResultMap">
		<id property="categoryCode" column="CATEGORY_CODE"/>
		<result property="refCategoryName" column="REF_CATEGORY_NAME"/>
		<result property="categoryName" column="CATEGORY_NAME"/>
		<result property="refCategoryCode" column="REF_CATEGORY_CODE"/>
		<result property="categoryStatus" column="CATEGORY_STATUS"/>
	</resultMap>
	
	<resultMap type="com.deft.crud.product.model.dto.ManufacturerDTO" id="manufacturerResultMap">
		<id property="manufacturerNo" column="MANUFACTURER_NO"/>
		<result property="manufacturerName" column="MANUFACTURER_NAME"/>
	</resultMap>
	
	<resultMap type="com.deft.crud.product.model.dto.AccountDTO" id="accountResultMap">
		<id property="accountNo" column="ACCOUNT_NO"/>
		<result property="companyName" column="COMPANY_NAME"/>
		<result property="accountCeo" column="ACCOUNT_CEO"/>
		<result property="accountAddress" column="ACCOUNT_ADDRESS"/>
		<result property="accountStatus" column="ACCOUNT_STATUS"/>
		<result property="accountBusinessItem" column="ACCOUNT_BUSINESS_ITEM"/>
		<result property="resName" column="RES_NAME"/>
		<result property="resPhone" column="RES_PHONE"/>
		<result property="resEmail" column="RES_EMAIL"/>
		
	</resultMap>
	
	<select id="allProductList" resultMap="productResultMap">
	   SELECT /*com.deft.crud.product.model.dao.ProductMapper#allProductList()*/
	          P.PRODUCT_NO
     		, P.PRODUCT_NAME
     		, P.SELL_STATUS
     		, B.CATEGORY_NAME "REF_CATEGORY_NAME"
     		, A.REF_CATEGORY_CODE            
     		, A.CATEGORY_NAME
          FROM TBL_PRODUCT P
	      LEFT JOIN TBL_PRODUCT_CATEGORY A ON(P.CATEGORY_CODE = A.CATEGORY_CODE)
	      LEFT JOIN TBL_PRODUCT_CATEGORY B ON(A.REF_CATEGORY_CODE = B.CATEGORY_CODE)
	</select>
	
	<select id="allCategoryList" resultMap="productCategoryResultMap">
		SELECT /*com.deft.crud.product.model.dao.ProductMapper#allCategoryList()*/
       	       A.CATEGORY_NAME "REF_CATEGORY_NAME"
     		 , B.CATEGORY_NAME 
             , B.REF_CATEGORY_CODE
           FROM TBL_PRODUCT_CATEGORY A
           JOIN TBL_PRODUCT_CATEGORY B ON(B.REF_CATEGORY_CODE = A.CATEGORY_CODE)
	</select>
	
	<select id="refCategoryList" resultMap="productCategoryResultMap">
		 SELECT /*com.deft.crud.product.model.dao.ProductMapper#refCategoryList()*/
       	        A.CATEGORY_CODE "REF_CATEGORY_CODE"
     	   	  , A.CATEGORY_NAME "REF_CATEGORY_NAME"
  	       FROM TBL_PRODUCT_CATEGORY A
 		  WHERE REF_CATEGORY_CODE IS NULL
	
	</select>
	
	<select id="childrenCategoryList" resultMap="productCategoryResultMap">
		SELECT /*com.deft.crud.product.model.dao.ProductMapper#childrenCategoryList()*/
        	   A.CATEGORY_CODE 
             , A.CATEGORY_NAME 
          FROM TBL_PRODUCT_CATEGORY A
         WHERE A.REF_CATEGORY_CODE IS NOT NULL
	</select>
	
	<select id="manufacturerList" resultMap="manufacturerResultMap">
		SELECT /*com.deft.crud.product.model.dao.ProductMapper#manufacturerList()*/
			   A.MANUFACTURER_NO
			 , A.MANUFACTURER_NAME
		  FROM TBL_MANUFACTURER A
	</select>
	
	
	<select id="productDetail" resultMap="productResultMap">
		 SELECT /*com.deft.crud.product.model.dao.ProductMapper#productDetail()*/
                P.PRODUCT_NO
	   		  , P.PRODUCT_NAME
	   		  , T.MANUFACTURER_NAME
	   		  , P.SELL_STATUS
	   	      , P.SELLING_PRICE
	   	      , P.PURCHASE_PRICE
	   	      , CA.REF_CATEGORY_CODE
	   	      , CB.CATEGORY_NAME "REF_CATEGORY_NAME"
	   	      , CA.CATEGORY_NAME
	   	      , A.COMPANY_NAME
          FROM TBL_PRODUCT P
	      LEFT JOIN TBL_PRODUCT_CATEGORY CA ON(P.CATEGORY_CODE = CA.CATEGORY_CODE)
	      LEFT JOIN TBL_PRODUCT_CATEGORY CB ON(CA.REF_CATEGORY_CODE = CB.CATEGORY_CODE)
	      JOIN TBL_ACCOUNT A ON(P.ACCOUNT_NO = A.ACCOUNT_NO)
	      JOIN TBL_MANUFACTURER T ON(P.MANUFACTURER_NO = T.MANUFACTURER_NO)
	      WHERE P.PRODUCT_NO = #{ productNo }
	</select>
	
	<select id="findChildrenCategoryList" resultMap="productCategoryResultMap">
		SELECT /*com.deft.crud.product.model.dao.ProductMapper#findChildrenCategoryList()*/
			   PC.CATEGORY_CODE
			 , PC.CATEGORY_NAME
			 , PC.REF_CATEGORY_CODE
		  FROM TBL_PRODUCT_CATEGORY PC
		 WHERE REF_CATEGORY_CODE = #{ categoryCode }
			   
	</select>
	
	<select id="accountList" resultMap="accountResultMap">
		SELECT /*com.deft.crud.product.model.dao.ProductMapper#accountList()*/
			   A.ACCOUNT_NO
			 , A.COMPANY_NAME
		  FROM TBL_ACCOUNT A
	
	</select>
	
	<update id="updateProduct" parameterType="com.deft.crud.product.model.dto.ProductDTO">
		UPDATE /*com.deft.crud.product.model.dao.ProductMapper#updateProduct()*/
			   TBL_PRODUCT A
		   SET A.SELL_STATUS = #{ sellStatus }
		     , A.PRODUCT_NAME = #{ productName }
		     , A.PURCHASE_PRICE = #{ purchasePrice }
		     , A.SELLING_PRICE = #{ sellingPrice }
		     , A.CATEGORY_CODE = #{ categoryCode }
		     , A.ACCOUNT_NO = #{ accountNo } 
		     , A.MANUFACTURER_NO = #{ manufacturerNo }
		 WHERE A.PRODUCT_NO = #{ productNo } 
	</update>
</mapper>