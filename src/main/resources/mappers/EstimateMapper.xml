<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.deft.crud.estimate.model.dao.EstimateMapper">
	<resultMap type="com.deft.crud.estimate.model.dto.EstimateDTO" id="estimateSelectResultMap">
		<id property="estimateNo" column="ESTIMATE_NO"/>
		<result property="estimateTitle" column="ESTIMATE_TITLE"/>
		<result property="estimateDate" column="ESTIMATE_DATE"/>
		<result property="customerNo" column="CUSTOMER_NO"/>
		<result property="discountRate" column="DISCOUNT_RATE"/>
		<result property="estimateStatus" column="ESTIMATE_STATUS"/>
		<result property="providerRegistNo" column="PROVIDER_REGIST_NO"/>
		
		<association property="customer" javaType="com.deft.crud.customer.model.dto.CustomerDTO">
			<id property="customerNo" column="CUSTOMER_NO"/>
			<result property="customerName" column="CUSTOMER_NAME"/>

			<association property="empInfo" javaType="com.deft.crud.customer.model.dto.EmpInfoDTO">
				<id property="empNo" column="EMP_NO"/>
				<result property="empName" column="EMP_NAME"/>
			</association>
		</association>
		
		<association property="provider" javaType="com.deft.crud.estimate.model.dto.ProviderDTO">
			<id property="providerRegistNo" column="PROVIDER_REGIST_NO"/>
		</association>
	</resultMap>
	
	<select id="selectEstimateList" resultMap="estimateSelectResultMap">
        SELECT /* com.deft.crud.estimate.model.dao.EstimateMapper#selectEstimateList() */
               E.ESTIMATE_NO
             , C.CUSTOMER_NAME
             , E.ESTIMATE_TITLE
             , E.ESTIMATE_STATUS
             , EI.EMP_NAME
             , E.ESTIMATE_DATE
          FROM TBL_ESTIMATE E
          LEFT JOIN TBL_CUSTOMER C ON (E.CUSTOMER_NO = C.CUSTOMER_NO)
          LEFT JOIN TBL_EMP_INFO EI ON (C.EMP_NO = EI.EMP_NO)
         ORDER BY E.ESTIMATE_NO DESC
	</select>
	
	<select id="selectEstimateListByStatus" resultMap="estimateSelectResultMap">
        SELECT /* com.deft.crud.estimate.model.dao.EstimateMapper#selectEstimateListByStatus() */
               E.ESTIMATE_NO
             , C.CUSTOMER_NAME
             , E.ESTIMATE_TITLE
             , E.ESTIMATE_STATUS
             , EI.EMP_NAME
             , E.ESTIMATE_DATE
          FROM TBL_ESTIMATE E
          LEFT JOIN TBL_CUSTOMER C ON (E.CUSTOMER_NO = C.CUSTOMER_NO)
          LEFT JOIN TBL_EMP_INFO EI ON (C.EMP_NO = EI.EMP_NO)
		<choose>
			<when test="estimateStatus == 'progress'">
                WHERE E.ESTIMATE_STATUS = '진행중'
         	</when>
         	<when test="estimateStatus == 'success'">
                WHERE E.ESTIMATE_STATUS = '완료'
         	</when>
         	<when test="estimateStatus == 'postpone'">
                WHERE E.ESTIMATE_STATUS = '보류'
         	</when>
         	<when test="estimateStatus == 'failed'">
                WHERE E.ESTIMATE_STATUS = '실패'
         	</when>
         </choose>
         ORDER BY E.ESTIMATE_NO DESC
	</select>
	
	<select id="selectLastEstimateSeq" resultType="java.lang.String">
        SELECT /* com.deft.crud.estimate.model.dao.EstimateMapper#selectLastEstimateSeq() */
               LPAD(LAST_NUMBER, 3, 0)
          FROM USER_SEQUENCES
         WHERE SEQUENCE_NAME = 'SEQ_ESTIMATE_NO'
	</select>
</mapper>