<!DOCTYPE html>
<html lang="ko"
	xmlns:th="https://www.thymeleaf.org">
<head>
	<th:block th:replace="@{common/config} :: config"></th:block>
</head>

<body id="page-top">
	<div id="wrapper">
		<!-- Sidebar -->
		<th:block th:replace="@{/common/sidebar} :: sidebar"></th:block>

		<div id="content-wrapper" class="d-flex flex-column">
			<div id="content">
				<!-- Header -->
				<th:block th:replace="@{/common/header} :: header"></th:block>

				<!-- Content -->
				<div class="container-fluid" id="container-wrapper">
					<div class="d-sm-flex align-items-center justify-content-between mb-4">
						<h1 class="h3 mb-0 text-gray-800">견적서 관리</h1>
						<ol class="breadcrumb">
							<li class="breadcrumb-item"><a th:href="@{/}">Home</a></li>
							<li class="breadcrumb-item"><a th:href="@{/estimate/selectAll}">견적서 조회</a></li>
							<li class="breadcrumb-item active" aria-current="page">견적서 작성</li>
						</ol>
					</div>

					<div class="row">
						<div class="col-lg-12">
							<form>
								<!-- EstimateInfo -->
								<div class="card mb-4">
									<div class="card-header py-3 d-flex flex-row align-items-center justify-content-between">
										<h6 class="m-0 font-weight-bold text-primary" id="tableTitle">견적서 작성</h6>
									</div>
									<div class="card-body">
										<div class="form-group row mb-2" th:align="right">
												<label for="estimateTitle" class="col-lg-1 col-form-label">제목</label>
												<input type="text" class="form-control col-lg-10" id="estimateTitle" name="estimateTitle">
										</div>
										<div class="form-group row mb-2" th:align="right">
											<label for="estimateNo" class="col-lg-1 col-form-label">견적번호</label>
											<input type="text" class="form-control col-lg-4" id="estimateNo" name="estimateNo" readonly>
											<label for="estimateDate" class="col-lg-2 col-form-label">견적일자</label>
											<input type="text" class="form-control col-lg-4" id="estimateDate" name="estimateDate" readonly>
										</div>
										<div class="form-group row mb-2" th:align="right">
											<label for="customerCompany" class="col-lg-1 col-form-label">고객사</label>
											<input type="text" class="form-control col-lg-4" id="customerCompany" name="customerCompany" readonly>
											<label for="customerName" class="col-lg-2 col-form-label">고객명</label>
											<input class="form-control col-lg-4" id="customerName" name="customerName" readonly>
											<input class="form-control" id="customerNo" name="customerNo" hidden="hidden">
											<div class="input-group-append">
												<button type="button" class="btn btn-primary" id="searchCustomer"
														data-toggle="modal" data-target="#customerModal">검색</button>
											</div>
										</div>
										<div class="form-group row mb-4" th:align="right">
											<label for="estimateStatus" class="col-lg-1 col-form-label">진행상태</label>
											<select class="form-control col-lg-4" id="estimateStatus" name="estimateStatus">
												<option th:text="진행중"></option>
												<option th:text="완료"></option>
												<option th:text="보류"></option>
												<option th:text="실패"></option>
											</select>
											<label for="resEmp" class="col-lg-2 col-form-label">담당사원</label>
											<input type="text" class="form-control col-lg-4" id="resEmp" name="resEmp" readonly>
										</div>

										<div class="form-group row mb-2" th:align="right">
											<label class="col-lg-1 col-form-label">금액할인</label>
											<div class="custom-control custom-radio mt-2 col-lg-1">
												<input type="radio" class="custom-control-input" id="noApplyDiscount" name="discount" value="N" checked>
												<label for="noApplyDiscount" class="custom-control-label">미적용</label>
											</div>
											<div class="custom-control custom-radio mt-2 col-lg-1">
												<input type="radio" class="custom-control-input" id="applyDiscount" name="discount" value="Y">
												<label for="applyDiscount" class="custom-control-label">적용</label>
											</div>
											<div class="form-group">
												<input type="text" class="form-control col-lg-3" id="discountRate" name="discountRate" disabled>
											</div>
										</div>
										<div class="form-group row mb-2" th:align="right">
											<label for="estimateDate" class="col-lg-1 col-form-label">합계금액</label>
											<input type="text" class="form-control col-lg-10" id="estimateDate" readonly>
										</div>
									</div>
								</div>		<!-- End EstimateInfo -->

								<!-- EstimateProductList -->
								<div class="card mb-4">
									<div class="card-header py-3 d-flex flex-row align-items-center justify-content-between">
										<h6 class="m-0 font-weight-bold text-primary" id="tableTitle">상품 추가</h6>
									</div>
									<div class="table-responsible">
										<table class="table align-items-center table-flush">
											<thead class="thead-light">
											  <tr>
												<th>No</th>
												<th>상품번호</th>
												<th>상품명</th>
												<th>판매가</th>
												<th>공급가</th>
												<th>단위</th>
												<th>수량</th>
												<th>합계</th>
												<th>세액</th>
												<th></th>
											  </tr>
											</thead>
											<tbody>
												<tr>
													<td colspan="10" th:align="center">
														<a href="#" class="btn btn-sm btn-dark btn-icon-split">
															<span class="icon text-white-50"><i class="fas fa-search-plus"></i></span>
															<span class="text text-white">상품 추가</span>
														</a>
													</td>
												</tr>
											</tbody>
										</table>
									</div>
								</div>		<!-- End EstimateProductList -->

								<div th:align="center">
									<button type="submit" class="btn btn-primary mx-2">등록</button>
									<button type="reset" class="btn btn-outline-danger mx-2">취소</button>
								</div>
							</form>
						</div>
					</div>

					<!-- CustomerModal -->
					<div class="modal fade" id="customerModal" tabindex="-1" role="dialog" aria-labelledby="customerModalLabel"
							aria-hidden="true">
						<div class="modal-dialog modal-xl modal-dialog-centered" role="document">
							<div class="modal-content">
								<div class="modal-header">
									<h5 class="modal-title font-weight-bold" id="customerModalLabel">고객 조회</h5>
									<button type="button" class="close" data-dismiss="modal" aria-label="Close">
										<span aria-hidden="true"><i class="far fa-times-circle"></i></span>
									</button>
								</div>
								<div class="modal-body">
									<div class="row">
										<div class="col-lg-12">
											<div class="card mb-4">
												<div class="table-responsive p-3" style="height:500px; overflow:auto;">
													<table class="table align-items-center table-flush table-hover" id="customerTable">
														<thead class="thead-light" th:align="center">
															<tr>
																<th>고객번호</th>
																<th>업태</th>
																<th>고객사</th>
																<th>고객명</th>
																<th>담당사원</th>
																<th></th>
															</tr>
														</thead>
														<tbody th:align="center">
															<tr th:each="customer : ${ customerList }">
																<td th:text="${ customer.customerNo }"></td>
																<td th:text="${ customer.company.businessStatus }"></td>
																<td th:text="${ customer.company.companyName }"></td>
																<td th:text="${ customer.customerName }"></td>
																<td th:text="${ customer.empInfo.empName }"></td>
																<td>
																	<button class="btn btn-sm btn-dark" name="selectCustomer"
																	th:text="'선택'" data-dismiss="modal"></button>
																</td>
															</tr>
														</tbody>
													</table>
												</div>
											</div>
										</div>
									</div>
								</div>
								<div class="modal-footer mb-6">
									<button type="button" class="btn btn-outline-primary" data-dismiss="modal">닫기</button>
								</div>
							</div>
						</div>
					</div>		<!-- End CustomerModal -->
				</div>
			</div>
		</div>
	</div>

	<!-- Script -->
	<th:block th:replace="@{/common/script} :: script"></th:block>
	<script>
		$(document).ready(function() {
			$('#customerTable').DataTable(); // ID From dataTable with Hover

			$("input:radio[name=discount]").on('click', function() {
				if($(this).val() == 'Y') {
					$("#discountRate").attr("disabled", false);
				} else {
					$("#discountRate").attr("disabled", true);
				}
			});

			$("#discountRate").TouchSpin({
				min: 0,
				max: 100,
				decimals: 1,
				step: 1,
				postfix: '%',
				initval: 0,
				boostat: 5,
				maxboostedstep: 10
			});

			$("button[name='selectCustomer']").on("click", function() {
				$tr = $(this).parent().parent();

				const customerNo = $tr.children().eq(0).text();
				const customerCompany = $tr.children().eq(2).text();
				const customerName = $tr.children().eq(3).text();
				const empName = $tr.children().eq(4).text();
				
				$("#customerCompany").val(customerCompany);
				$("#customerName").val(customerName);
				$("#customerNo").val(customerNo);
				$("#resEmp").val(empName);
			});
		});
	</script>
</body>

</html>

